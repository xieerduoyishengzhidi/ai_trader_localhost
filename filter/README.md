# Pentosh1 新闻筛选模块

使用 DeepSeek API 对新闻进行大规模筛选，筛选出符合 Pentosh1 量化交易策略的新闻。

## 功能特性

- ✅ 批量处理新闻（默认每批 20 条）
- ✅ 自动跳过已筛选的新闻（支持断点续传）
- ✅ API 调用重试机制（最多 3 次）
- ✅ 实时进度显示
- ✅ 筛选统计信息

## 安装依赖

```powershell
pip install -r filter/requirements.txt
```

## 使用方法

### 1. 设置 DeepSeek API Key

```powershell
$env:DEEPSEEK_API_KEY="your_api_key_here"
```

### 2. 运行筛选脚本

**方法 1：使用 PowerShell 脚本（推荐）**

```powershell
.\filter\start_filter.ps1
```

**方法 2：直接运行 Python 脚本**

```powershell
python filter/pentosh1_filter.py
```

## 配置说明

### 环境变量

- `DEEPSEEK_API_KEY`: DeepSeek API Key（必需）
- `DEEPSEEK_MODEL`: 使用的模型（默认: `deepseek-chat`）

### 代码配置

在 `pentosh1_filter.py` 中可以修改：

- `BATCH_SIZE`: 每批处理的新闻数量（默认: 20）
- `MAX_RETRIES`: API 调用最大重试次数（默认: 3）
- `RETRY_DELAY`: 重试延迟秒数（默认: 2）

## 数据库结构

### 源数据库 (`news_service/history_news.db`)

- `history_news` 表：包含所有新闻数据

### 目标数据库 (`filter/pentosh1.db`)

- `pentosh1_news` 表：包含筛选后的新闻
  - `index_id`: 自增主键
  - `source_index_id`: 外键，引用源数据库 `history_news` 表的 `index_id`（唯一约束）
  - `id`: 新闻 ID
  - `url`: 新闻 URL
  - `title`: 标题
  - `content`: 内容
  - `summary`: 摘要
  - `source`: 来源
  - `publish_time`: 发布时间
  - `crawled_at`: 爬取时间
  - `filtered_at`: 筛选时间

## 筛选标准

筛选基于 Pentosh1 的量化交易策略（S1 趋势跟踪 & S3 事件驱动），重点关注：

1. **机构资金流**：ETF 活动、企业财库、TradFi 整合
2. **监管政策**：立法、行政行动、SEC/CFTC 决定
3. **宏观流动性**：美联储政策、全球流动性、国债收益率
4. **供需机制**：供应冲击、交易所数据
5. **高确定性叙事**：RWA/代币化、稳定币扩张、基础设施

详细筛选标准见代码中的 `SYSTEM_PROMPT`。

## 注意事项

1. **API 限流**：脚本在每批之间有 1 秒延迟，避免触发限流
2. **断点续传**：如果中断，重新运行会自动跳过已筛选的新闻
3. **数据完整性**：使用 `original_index_id` 确保数据可追溯
4. **成本估算**：假设每批 20 条新闻，1000 条新闻约需 50 次 API 调用

## 示例输出

```
================================================================================
🔍 Pentosh1 新闻筛选系统
================================================================================

✅ 源数据库: news_service\history_news.db
📂 目标数据库: filter\pentosh1.db
✅ 目标数据库已初始化

🤖 初始化 DeepSeek API 客户端...
   模型: deepseek-chat
   批次大小: 20

📊 统计信息:
   源数据库总新闻数: 1,234
   已筛选新闻数: 0
   待筛选新闻数: 1,234

================================================================================
🚀 开始批量筛选...
================================================================================

📦 批次 #1: 处理 20 条新闻 (索引 0 - 19)
   ✅ 选中 5 条新闻
   进度: 20/1,234 (1.6%) | 已选中: 5

📦 批次 #2: 处理 20 条新闻 (索引 20 - 39)
   ✅ 选中 3 条新闻
   进度: 40/1,234 (3.2%) | 已选中: 8

...

================================================================================
✅ 筛选完成！
================================================================================

📊 最终统计:
   处理批次: 62
   处理新闻数: 1,234
   选中新闻数: 186
   筛选率: 15.07%
   耗时: 125.3 秒
   平均速度: 9.8 条/秒

📂 结果已保存到: filter\pentosh1.db
```

