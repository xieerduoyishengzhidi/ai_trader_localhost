# å…ƒæ•°æ®è¿‡æ»¤è¯´æ˜

## BM25 æœç´¢å­—æ®µ

BM25 æœç´¢åœ¨ **documents** å­—æ®µä¸Šè¿›è¡Œï¼Œè¯¥å­—æ®µç”±ä»¥ä¸‹ CSV åˆ—ç»„åˆè€Œæˆï¼š

- `text` - åŸå§‹æ¨æ–‡æ–‡æœ¬
- `info_overall_assessment` - ç»¼åˆè¯„ä¼°
- `gpt_explanation` - GPT è§£é‡Š
- `gpt_reason` - GPT åŸå› 

æ ¼å¼ï¼š`text | info_overall_assessment | gpt_explanation | gpt_reason`

## å…ƒæ•°æ®å­—æ®µ

ChromaDB ä¸­å­˜å‚¨çš„å…ƒæ•°æ®å­—æ®µï¼ˆå¯ç”¨äºè¿‡æ»¤ï¼‰ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | è¿‡æ»¤æ–¹å¼ |
|--------|------|------|---------|
| `screen_name` | string | ç”¨æˆ·åï¼ˆå¦‚ "Pentosh1"ï¼‰ | âœ… æ•°æ®åº“å±‚é¢ï¼ˆwhereï¼‰ |
| `display_name` | string | æ˜¾ç¤ºåç§°ï¼ˆå¦‚ "ğŸ§ Pentoshi"ï¼‰ | âŒ ä¸æ”¯æŒï¼ˆå¯é€šè¿‡ trader_name é—´æ¥åŒ¹é…ï¼‰ |
| `gpt_assets` | JSON string | æ¶‰åŠçš„èµ„äº§ï¼ˆå¦‚ `["SOL", "BTC"]`ï¼‰ | âš ï¸ ç»“æœå±‚é¢ï¼ˆJSON æ•°ç»„ï¼‰ |
| `gpt_sentiment` | string | æƒ…æ„Ÿï¼ˆ"positive"/"negative"ï¼‰ | âœ… æ•°æ®åº“å±‚é¢ï¼ˆwhereï¼‰ |
| `is_market_related` | bool | æ˜¯å¦ä¸å¸‚åœºç›¸å…³ | âœ… æ•°æ®åº“å±‚é¢ï¼ˆwhereï¼‰ |
| `info_final_score` | number | æœ€ç»ˆè¯„åˆ† | âœ… æ•°æ®åº“å±‚é¢ï¼ˆwhereï¼Œéœ€èŒƒå›´æŸ¥è¯¢ï¼‰ |
| `created_at` | string | åˆ›å»ºæ—¶é—´ | âœ… æ•°æ®åº“å±‚é¢ï¼ˆwhereï¼Œéœ€èŒƒå›´æŸ¥è¯¢ï¼‰ |

## API ä½¿ç”¨ç¤ºä¾‹

### 1. æŸ¥è¯¢æŸä¸ªäº¤æ˜“å‘˜çš„æŸä¸ªæ ‡çš„

```http
POST /query
{
    "trader_name": "Pentosh1",
    "asset": "SOL",
    "query_text": "ä»·æ ¼é¢„æµ‹",
    "limit": 5
}
```

**å¤„ç†æµç¨‹**ï¼š
1. ä½¿ç”¨ `where={"screen_name": "Pentosh1"}` åœ¨æ•°æ®åº“å±‚é¢è¿‡æ»¤äº¤æ˜“å‘˜
2. BM25 å’Œå‘é‡æœç´¢åœ¨è¿‡æ»¤åçš„æ•°æ®ä¸Šè¿›è¡Œ
3. åœ¨ç»“æœä¸­è¿‡æ»¤ `gpt_assets` åŒ…å« "SOL" çš„æ–‡æ¡£

### 2. æŸ¥è¯¢æŸä¸ªäº¤æ˜“å‘˜çš„çœ‹æ¶¨è§‚ç‚¹

```http
POST /query
{
    "trader_name": "Pentosh1",
    "sentiment": "positive",
    "query_text": "å¸‚åœºåˆ†æ",
    "limit": 5
}
```

**å¤„ç†æµç¨‹**ï¼š
1. ä½¿ç”¨ `where={"screen_name": "Pentosh1", "gpt_sentiment": "positive"}` åœ¨æ•°æ®åº“å±‚é¢è¿‡æ»¤
2. BM25 å’Œå‘é‡æœç´¢åœ¨è¿‡æ»¤åçš„æ•°æ®ä¸Šè¿›è¡Œ

### 3. æŸ¥è¯¢æŸä¸ªæ ‡çš„çš„æ‰€æœ‰å¸‚åœºç›¸å…³è§‚ç‚¹

```http
POST /query
{
    "asset": "BTC",
    "is_market_related": true,
    "query_text": "ä»·æ ¼èµ°åŠ¿",
    "limit": 10
}
```

**å¤„ç†æµç¨‹**ï¼š
1. ä½¿ç”¨ `where={"is_market_related": true}` åœ¨æ•°æ®åº“å±‚é¢è¿‡æ»¤
2. BM25 å’Œå‘é‡æœç´¢åœ¨è¿‡æ»¤åçš„æ•°æ®ä¸Šè¿›è¡Œ
3. åœ¨ç»“æœä¸­è¿‡æ»¤ `gpt_assets` åŒ…å« "BTC" çš„æ–‡æ¡£

## è¿‡æ»¤æ•ˆç‡å¯¹æ¯”

### æ•°æ®åº“å±‚é¢è¿‡æ»¤ï¼ˆé«˜æ•ˆï¼‰âœ…

```python
# ä½¿ç”¨ where æ¡ä»¶ï¼ŒChromaDB åœ¨æ•°æ®åº“å±‚é¢è¿‡æ»¤
where_clause = {
    "screen_name": "Pentosh1",
    "gpt_sentiment": "positive"
}
results = collection.get(where=where_clause)
```

**ä¼˜åŠ¿**ï¼š
- åªè¿”å›åŒ¹é…çš„æ•°æ®
- åˆ©ç”¨æ•°æ®åº“ç´¢å¼•åŠ é€Ÿ
- å†…å­˜å ç”¨å°
- é€Ÿåº¦å¿«

### ç»“æœå±‚é¢è¿‡æ»¤ï¼ˆä½æ•ˆï¼‰âš ï¸

```python
# è·å–æ‰€æœ‰æ•°æ®ï¼Œç„¶ååœ¨ Python ä¸­è¿‡æ»¤
all_results = collection.get(limit=5000)
filtered = [r for r in all_results if "SOL" in r.metadata['gpt_assets']]
```

**åŠ£åŠ¿**ï¼š
- éœ€è¦åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜
- åœ¨ Python ä¸­å¾ªç¯è¿‡æ»¤
- å†…å­˜å ç”¨å¤§
- é€Ÿåº¦æ…¢

**ä¸ºä»€ä¹ˆ asset è¿‡æ»¤åœ¨ç»“æœå±‚é¢ï¼Ÿ**

å› ä¸º `gpt_assets` æ˜¯ JSON æ•°ç»„ï¼ˆå¦‚ `["SOL", "BTC"]`ï¼‰ï¼ŒChromaDB çš„ where æ¡ä»¶ä¸æ”¯æŒ JSON æ•°ç»„æŸ¥è¯¢ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç»“æœä¸­è¿‡æ»¤ã€‚

## æ”¯æŒçš„å…ƒæ•°æ®è¿‡æ»¤

### 1. trader_name (screen_name)

```json
{
    "trader_name": "Pentosh1"
}
```

**è¿‡æ»¤æ–¹å¼**ï¼šæ•°æ®åº“å±‚é¢ï¼ˆwhereï¼‰

### 2. asset (gpt_assets)

```json
{
    "asset": "SOL"
}
```

**è¿‡æ»¤æ–¹å¼**ï¼šç»“æœå±‚é¢ï¼ˆJSON æ•°ç»„è§£æï¼‰

**æ³¨æ„**ï¼š`gpt_assets` å­˜å‚¨ä¸º JSON å­—ç¬¦ä¸²ï¼Œå¦‚ `["SOL", "BTC"]`ï¼Œéœ€è¦è§£æååŒ¹é…ã€‚

### 3. sentiment (gpt_sentiment)

```json
{
    "sentiment": "positive"  // æˆ– "negative"
}
```

**è¿‡æ»¤æ–¹å¼**ï¼šæ•°æ®åº“å±‚é¢ï¼ˆwhereï¼‰

### 4. is_market_related

```json
{
    "is_market_related": true  // æˆ– false
}
```

**è¿‡æ»¤æ–¹å¼**ï¼šæ•°æ®åº“å±‚é¢ï¼ˆwhereï¼‰

## ç»„åˆæŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢ Pentosh1 å…³äº SOL çš„çœ‹æ¶¨è§‚ç‚¹

```http
POST /query
{
    "trader_name": "Pentosh1",
    "asset": "SOL",
    "sentiment": "positive",
    "query_text": "ä»·æ ¼é¢„æµ‹",
    "limit": 5
}
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. âœ… æ•°æ®åº“å±‚é¢ï¼š`where={"screen_name": "Pentosh1", "gpt_sentiment": "positive"}`
2. âœ… BM25 æœç´¢ï¼šåœ¨è¿‡æ»¤åçš„ documents ä¸Šæœç´¢ "ä»·æ ¼é¢„æµ‹"
3. âœ… å‘é‡æœç´¢ï¼šåœ¨è¿‡æ»¤åçš„æ•°æ®ä¸Šæœç´¢ "ä»·æ ¼é¢„æµ‹"
4. âœ… RRF åˆå¹¶ï¼šåˆå¹¶ BM25 å’Œå‘é‡æœç´¢ç»“æœ
5. âš ï¸ ç»“æœå±‚é¢ï¼šè¿‡æ»¤ `gpt_assets` åŒ…å« "SOL" çš„æ–‡æ¡£

## æ€§èƒ½å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“å±‚é¢è¿‡æ»¤**ï¼š
   - `trader_name` âœ…
   - `sentiment` âœ…
   - `is_market_related` âœ…

2. **é¿å…å¤§é‡æ•°æ®çš„ç»“æœå±‚é¢è¿‡æ»¤**ï¼š
   - `asset` âš ï¸ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼Œå»ºè®®å…ˆç¼©å°èŒƒå›´ï¼‰

3. **ç»„åˆä½¿ç”¨**ï¼š
   - å…ˆç”¨æ•°æ®åº“å±‚é¢è¿‡æ»¤ç¼©å°èŒƒå›´
   - å†ç”¨ç»“æœå±‚é¢è¿‡æ»¤ç²¾ç¡®åŒ¹é…

## æœªæ¥ä¼˜åŒ–

å¯ä»¥è€ƒè™‘ï¼š
1. å°† `gpt_assets` å±•å¼€ä¸ºå•ç‹¬çš„å…ƒæ•°æ®å­—æ®µï¼ˆå¦‚ `asset_SOL`, `asset_BTC`ï¼‰
2. ä½¿ç”¨ ChromaDB çš„ `$in` æ“ä½œç¬¦æ”¯æŒæ•°ç»„æŸ¥è¯¢
3. æ·»åŠ æ—¶é—´èŒƒå›´æŸ¥è¯¢æ”¯æŒ

